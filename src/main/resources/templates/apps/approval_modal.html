<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<link
	href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>


<title>모달창</title>
<style>
.jstree-icon.ri-building-fill {
	color: #3e4a6e;
	font-size: 24px;
}

.jstree-icon.ri-team-fill {
	color: #3577f1;
	font-size: 20px;
}

.jstree-icon.ri-user-2-fill {
	color: #9a9ba0;
	font-size: 16px;
}
</style>
</head>
<body>
		<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="myModalLabel">직원선택</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                <div id="treeMenu"></div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
	                <button type="button" class="btn btn-primary" id="chooseButton">등록</button>
	            </div>
	        </div>
	    </div>
	</div>

	<script>
    $(document).ready(function() {
    	
    	$('#myModal').on('show.bs.modal', function () {
    	    console.log('모달이 열렸습니다.'); // 추가된 로그
    	    $.ajax({
    	        url: '/approval/modal', // 데이터를 가져올 URL
    	        method: 'GET',
    	        dataType: 'json',
    	        success: function(data) {
    	            console.log(data); // 추가된 로그
    	            const formatDataForJsTree = (nodes) => {
                        return nodes.map(node => {
                            return {
                                id: node.nodeId,
                                text: node.nodeName,
                                state: { opened: false },
                                children: node.nodeChildren ? formatDataForJsTree(node.nodeChildren) : [],
                                icon: node.nodeChildren && node.nodeChildren.length > 0 ? 'ri-team-fill' : 'ri-user-2-fill'
                            };
                        });
                    };
                    const formattedData = formatDataForJsTree(data);
                    const companyNode = {
                        id: 'companyName',
                        text: 'withXwork',
                        state: { opened: true },
                        children: formattedData,
                        icon: 'ri-building-fill'
                    };

                    $('#treeMenu').jstree({
                        'core': {
                            "animation": 0,
                            "check_callback": false,
                            'data': [companyNode]
                        },
                        "plugins": ["types"],
                        "types": {
                            "default": { "icon": "ri-team-fill" },
                            "file": { "icon": "ri-user-2-fill" }
                        }
                    });
    	        },
    	        error: function(xhr, status, error) {
    	            console.error("데이터 로드 오류: " + error);
    	        }
    	    });
    	});

    	
   

        // 등록 버튼 이벤트
        $(document).on('click', '#chooseButton', function() {
            const selectedNodes = $('#treeMenu').jstree("get_selected", true);
            selectedNodes.forEach(node => {
                console.log(node.text); // 선택된 직원 이름을 콘솔에 출력
            });
        });
    });
</script>

</body>
</html>
